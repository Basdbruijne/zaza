language: python
matrix:
  include:
    - name: "Python 3.6 on Ubuntu 16.04"
      python: 3.6
      dist: xenial
      sudo: true
    - name: "Python 3.7 on Ubuntu 18.04"
      python: 3.7
      dist: bionic
      sudo: true
install: pip install tox-travis
env:
  matrix:
    - ENV=pep8
    - ENV=pyi3
    - ENV=func-travis
comment: |
  install dependencies in script phase saving time on simpler test environments
  sudo back to ourself to activate lxd group membership executable search path
script:
  - if [ $ENV = 'func-travis' ]; then
       sudo apt remove -y --purge lxd lxd-client;
       sudo snap install lxd;
       sudo snap install juju --classic;
       sudo sh -c 'echo PATH=/snap/bin:$PATH >> /etc/environment';
       sudo lxd waitready;
       sudo lxd init --auto;
       sudo usermod -a -G lxd travis;
       sudo su travis -c 'juju bootstrap --debug --no-gui localhost';
    fi
  - tox -c tox.ini -e $ENV
  - if [ $ENV = 'func-travis' ]; then
    sudo su travis -c 'juju status -m $(juju models --format yaml|grep "^- name:.*zaza"|cut -f2 -d/)';
    fi
